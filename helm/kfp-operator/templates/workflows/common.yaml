apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: {{ include "kfp-operator.fullname" . }}-common-steps
  namespace: {{ include "kfp-operator.argoNamespace" . }}
spec:
  templates:
  - name: select-provider-parameter
    inputs:
      parameters:
      - name: parameter
    script:
      volumeMounts:
      - name: providers-config
        mountPath: /providers-config
      command:
      - ash
      image: mikefarah/yq:4.27.5
      source: yq e '.{{`{{inputs.parameters.parameter}}`}}' '/providers-config/{{`{{workflow.parameters.provider-name}}`}}'
  - name: select-resource-image
    inputs:
      artifacts:
      - name: resource-definition
        path: /resource-definition.yaml
        raw:
          data: |
            {{`{{workflow.parameters.resource-definition}}`}}
    script:
      command:
      - ash
      image: mikefarah/yq:4.27.5
      source: yq e '.image' /resource-definition.yaml
