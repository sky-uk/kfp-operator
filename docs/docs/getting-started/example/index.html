<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.101.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=https://sky-uk.github.io/kfp-operator/favicons/favicon.ico><link rel=apple-touch-icon href=https://sky-uk.github.io/kfp-operator/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=https://sky-uk.github.io/kfp-operator/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=https://sky-uk.github.io/kfp-operator/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://sky-uk.github.io/kfp-operator/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=https://sky-uk.github.io/kfp-operator/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=https://sky-uk.github.io/kfp-operator/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=https://sky-uk.github.io/kfp-operator/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=https://sky-uk.github.io/kfp-operator/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=https://sky-uk.github.io/kfp-operator/favicons/android-192x192.png sizes=192x192><title>Example | KFP-Operator</title><meta name=description content="This tutorial walks you through the creation of a simple TFX pipeline and shows you how to manage pipelines via Kubernetes Custom Resources.
All code â€¦"><meta property="og:title" content="Example"><meta property="og:description" content="This tutorial walks you through the creation of a simple TFX pipeline and shows you how to manage pipelines via Kubernetes Custom Resources.
All code samples can be found on GitHub.
We assume that you are already familiar with TFX and Kubeflow and that you have access to a running instance of Kubeflow Pipelines.
1. Build the Pipeline We use the same pipeline as the TFX example with a few modifications."><meta property="og:type" content="article"><meta property="og:url" content="https://sky-uk.github.io/kfp-operator/docs/getting-started/example/"><meta property="article:section" content="docs"><meta itemprop=name content="Example"><meta itemprop=description content="This tutorial walks you through the creation of a simple TFX pipeline and shows you how to manage pipelines via Kubernetes Custom Resources.
All code samples can be found on GitHub.
We assume that you are already familiar with TFX and Kubeflow and that you have access to a running instance of Kubeflow Pipelines.
1. Build the Pipeline We use the same pipeline as the TFX example with a few modifications."><meta itemprop=wordCount content="1160"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Example"><meta name=twitter:description content="This tutorial walks you through the creation of a simple TFX pipeline and shows you how to manage pipelines via Kubernetes Custom Resources.
All code samples can be found on GitHub.
We assume that you are already familiar with TFX and Kubeflow and that you have access to a running instance of Kubeflow Pipelines.
1. Build the Pipeline We use the same pipeline as the TFX example with a few modifications."><link rel=preload href=https://sky-uk.github.io/kfp-operator/scss/main.min.209ee91954d0f2f182770e6c71011a5580360636bcf2a9bcf7f1c3da478784ff.css as=style><link href=https://sky-uk.github.io/kfp-operator/scss/main.min.209ee91954d0f2f182770e6c71011a5580360636bcf2a9bcf7f1c3da478784ff.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=https://sky-uk.github.io/kfp-operator/><span class=navbar-logo></span><span class=font-weight-bold>KFP-Operator</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://sky-uk.github.io/kfp-operator/docs/><i class='fas fa-book pr-2'></i><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/sky-uk/kfp-operator/discussions target=_blank><i class='fas fa-comments'></i><span>Discuss</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/sky-uk/kfp-operator target=_blank><i class='fab fa-github pr-2'></i><span>GitHub</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=https://sky-uk.github.io/kfp-operator/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsgetting-started-li><a href=https://sky-uk.github.io/kfp-operator/docs/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsgetting-started><span>Getting Started</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgetting-startedoverview-li><a href=https://sky-uk.github.io/kfp-operator/docs/getting-started/overview/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgetting-startedoverview><span>Overview</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgetting-startedinstallation-li><a href=https://sky-uk.github.io/kfp-operator/docs/getting-started/installation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgetting-startedinstallation><span>Installation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgetting-startedexample-li><a href=https://sky-uk.github.io/kfp-operator/docs/getting-started/example/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-docsgetting-startedexample><span class=td-sidebar-nav-active-item>Example</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsreference-li><a href=https://sky-uk.github.io/kfp-operator/docs/reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsreference><span>Reference</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsreferenceconfiguration-li><a href=https://sky-uk.github.io/kfp-operator/docs/reference/configuration/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsreferenceconfiguration><span>Configuration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsreferenceresources-li><a href=https://sky-uk.github.io/kfp-operator/docs/reference/resources/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsreferenceresources><span>Resources</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsreferenceresourcespipeline-li><a href=https://sky-uk.github.io/kfp-operator/docs/reference/resources/pipeline/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsreferenceresourcespipeline><span>Pipeline</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsreferenceresourcesrunconfiguration-li><a href=https://sky-uk.github.io/kfp-operator/docs/reference/resources/runconfiguration/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsreferenceresourcesrunconfiguration><span>RunConfiguration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsreferenceresourcesexperiment-li><a href=https://sky-uk.github.io/kfp-operator/docs/reference/resources/experiment/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsreferenceresourcesexperiment><span>Experiment</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsreferencedebugging-li><a href=https://sky-uk.github.io/kfp-operator/docs/reference/debugging/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsreferencedebugging><span>Debugging</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsreferencerun-completion-li><a href=https://sky-uk.github.io/kfp-operator/docs/reference/run-completion/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsreferencerun-completion><span>Run Completion EventSource</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/sky-uk/kfp-operator/tree/master/docs-gen/content/en/docs/getting-started/example.md class=td-page-meta--view target=_blank rel=noopener><i class="fa fa-file-alt fa-fw"></i> View page source</a>
<a href=https://github.com/sky-uk/kfp-operator/edit/master/docs-gen/content/en/docs/getting-started/example.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/sky-uk/kfp-operator/new/master/docs-gen/content/en/docs/getting-started/example.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/sky-uk/kfp-operator/issues/new?title=Example" class=td-page-meta--issue target=_blank rel=noopener><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/sky-uk/kfp-operator/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fas fa-tasks fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#1-build-the-pipeline>1. Build the Pipeline</a></li><li><a href=#2-create-a-pipeline-resource>2. Create a Pipeline Resource</a></li><li><a href=#3-create-an-experiment-resource>3. Create an Experiment resource</a></li><li><a href=#4-create-a-pipeline-runconfiguration-resource>4. Create a pipeline RunConfiguration resource</a></li><li><a href=#5-optional-deploy-newly-trained-models>5. (Optional) Deploy newly trained models</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=https://sky-uk.github.io/kfp-operator/docs/>Documentation</a></li><li class=breadcrumb-item><a href=https://sky-uk.github.io/kfp-operator/docs/getting-started/>Getting Started</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://sky-uk.github.io/kfp-operator/docs/getting-started/example/>Example</a></li></ol></nav><div class=td-content><h1>Example</h1><header class=article-meta></header><p>This tutorial walks you through the creation of a simple TFX pipeline and shows you how to manage pipelines via Kubernetes Custom Resources.</p><p>All code samples can be found on <a href=https://github.com/sky-uk/kfp-operator/blob/master/docs-gen/includes/quickstart>GitHub</a>.</p><p>We assume that you are already familiar with TFX and Kubeflow and that you have access to a running instance of Kubeflow Pipelines.</p><h2 id=1-build-the-pipeline>1. Build the Pipeline</h2><p>We use the same pipeline as the <a href=https://www.tensorflow.org/tfx/tutorials/tfx/penguin_simple>TFX example</a> with a few modifications.</p><p>Create <code>pipeline.py</code>.
Note that the pipeline definition itself is simpler because all infrastructure references, like pusher and pipeline root, will be injected by the operator before the pipeline is uploaded to Kubeflow:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> List
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> tfx.components <span style=color:#f92672>import</span> CsvExampleGen, Trainer
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> tfx.proto <span style=color:#f92672>import</span> trainer_pb2
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> tfx.dsl.components.base.base_node <span style=color:#f92672>import</span> BaseNode
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>### Environmental parameters can be left out when using the operator.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>### Also, the return type is now a list of components instead of a pipeline.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#def create_pipeline(pipeline_name: str, pipeline_root: str, data_root: str,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#                    module_file: str, serving_model_dir: str,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#                    metadata_path: str) -&gt; tfx.dsl.Pipeline:</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>create_components</span>() <span style=color:#f92672>-&gt;</span> List[BaseNode]:
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Creates a penguin pipeline with TFX.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Brings data into the pipeline.</span>
</span></span><span style=display:flex><span>    example_gen <span style=color:#f92672>=</span> CsvExampleGen(input_base<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;/data&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Uses user-provided Python function that trains a model.</span>
</span></span><span style=display:flex><span>    trainer <span style=color:#f92672>=</span> Trainer(
</span></span><span style=display:flex><span>        run_fn<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;trainer.run_fn&#39;</span>,
</span></span><span style=display:flex><span>        examples<span style=color:#f92672>=</span>example_gen<span style=color:#f92672>.</span>outputs[<span style=color:#e6db74>&#39;examples&#39;</span>],
</span></span><span style=display:flex><span>        train_args<span style=color:#f92672>=</span>trainer_pb2<span style=color:#f92672>.</span>TrainArgs(num_steps<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>),
</span></span><span style=display:flex><span>        eval_args<span style=color:#f92672>=</span>trainer_pb2<span style=color:#f92672>.</span>EvalArgs(num_steps<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>### This needs to be omitted when using the operator.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>## Pushes the model to a filesystem destination.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#pusher = tfx.components.Pusher(</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#  model=trainer.outputs[&#39;model&#39;],</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#  push_destination=tfx.proto.PushDestination(</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#      filesystem=tfx.proto.PushDestination.Filesystem(</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#          base_directory=serving_model_dir)))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Following three components will be included in the pipeline.</span>
</span></span><span style=display:flex><span>    components <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>        example_gen,
</span></span><span style=display:flex><span>        trainer,
</span></span><span style=display:flex><span>        <span style=color:#75715e>#pusher</span>
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>### When using the operator, it creates the pipeline for us, </span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>### so we return the components directly instead.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#return tfx.dsl.Pipeline(</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#  pipeline_name=pipeline_name,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#  pipeline_root=pipeline_root,</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#  metadata_connection_config=tfx.orchestration.metadata</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#  .sqlite_metadata_connection_config(metadata_path),</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#  components=components)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> components
</span></span></code></pre></div><p>Create <code>trainer.py</code>.
The training code remains unchanged:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> List
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> absl <span style=color:#f92672>import</span> logging
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> tensorflow <span style=color:#66d9ef>as</span> tf
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> tensorflow <span style=color:#f92672>import</span> keras
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> tensorflow_transform.tf_metadata <span style=color:#f92672>import</span> schema_utils
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> tfx <span style=color:#f92672>import</span> v1 <span style=color:#66d9ef>as</span> tfx
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> tfx_bsl.public <span style=color:#f92672>import</span> tfxio
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> tensorflow_metadata.proto.v0 <span style=color:#f92672>import</span> schema_pb2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>_FEATURE_KEYS <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;culmen_length_mm&#39;</span>, <span style=color:#e6db74>&#39;culmen_depth_mm&#39;</span>, <span style=color:#e6db74>&#39;flipper_length_mm&#39;</span>, <span style=color:#e6db74>&#39;body_mass_g&#39;</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>_LABEL_KEY <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;species&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>_TRAIN_BATCH_SIZE <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>_EVAL_BATCH_SIZE <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Since we&#39;re not generating or creating a schema, we will instead create</span>
</span></span><span style=display:flex><span><span style=color:#75715e># a feature spec.  Since there are a fairly small number of features this is</span>
</span></span><span style=display:flex><span><span style=color:#75715e># manageable for this dataset.</span>
</span></span><span style=display:flex><span>_FEATURE_SPEC <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>**</span>{
</span></span><span style=display:flex><span>        feature: tf<span style=color:#f92672>.</span>io<span style=color:#f92672>.</span>FixedLenFeature(shape<span style=color:#f92672>=</span>[<span style=color:#ae81ff>1</span>], dtype<span style=color:#f92672>=</span>tf<span style=color:#f92672>.</span>float32)
</span></span><span style=display:flex><span>           <span style=color:#66d9ef>for</span> feature <span style=color:#f92672>in</span> _FEATURE_KEYS
</span></span><span style=display:flex><span>       },
</span></span><span style=display:flex><span>    _LABEL_KEY: tf<span style=color:#f92672>.</span>io<span style=color:#f92672>.</span>FixedLenFeature(shape<span style=color:#f92672>=</span>[<span style=color:#ae81ff>1</span>], dtype<span style=color:#f92672>=</span>tf<span style=color:#f92672>.</span>int64)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_input_fn</span>(file_pattern: List[str],
</span></span><span style=display:flex><span>              data_accessor: tfx<span style=color:#f92672>.</span>components<span style=color:#f92672>.</span>DataAccessor,
</span></span><span style=display:flex><span>              schema: schema_pb2<span style=color:#f92672>.</span>Schema,
</span></span><span style=display:flex><span>              batch_size: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>200</span>) <span style=color:#f92672>-&gt;</span> tf<span style=color:#f92672>.</span>data<span style=color:#f92672>.</span>Dataset:
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;&#34;&#34;Generates features and label for training.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  Args:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    file_pattern: List of paths or patterns of input tfrecord files.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    data_accessor: DataAccessor for converting input to RecordBatch.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    schema: schema of the input data.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    batch_size: representing the number of consecutive elements of returned
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      dataset to combine in a single batch
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  Returns:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    A dataset that contains (features, indices) tuple where features is a
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      dictionary of Tensors, and indices is a single Tensor of label indices.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> data_accessor<span style=color:#f92672>.</span>tf_dataset_factory(
</span></span><span style=display:flex><span>      file_pattern,
</span></span><span style=display:flex><span>      tfxio<span style=color:#f92672>.</span>TensorFlowDatasetOptions(
</span></span><span style=display:flex><span>          batch_size<span style=color:#f92672>=</span>batch_size, label_key<span style=color:#f92672>=</span>_LABEL_KEY),
</span></span><span style=display:flex><span>      schema<span style=color:#f92672>=</span>schema)<span style=color:#f92672>.</span>repeat()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_build_keras_model</span>() <span style=color:#f92672>-&gt;</span> tf<span style=color:#f92672>.</span>keras<span style=color:#f92672>.</span>Model:
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;&#34;&#34;Creates a DNN Keras model for classifying penguin data.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  Returns:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    A Keras Model.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># The model below is built with Functional API, please refer to</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># https://www.tensorflow.org/guide/keras/overview for all API options.</span>
</span></span><span style=display:flex><span>  inputs <span style=color:#f92672>=</span> [keras<span style=color:#f92672>.</span>layers<span style=color:#f92672>.</span>Input(shape<span style=color:#f92672>=</span>(<span style=color:#ae81ff>1</span>,), name<span style=color:#f92672>=</span>f) <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> _FEATURE_KEYS]
</span></span><span style=display:flex><span>  d <span style=color:#f92672>=</span> keras<span style=color:#f92672>.</span>layers<span style=color:#f92672>.</span>concatenate(inputs)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> _ <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>2</span>):
</span></span><span style=display:flex><span>    d <span style=color:#f92672>=</span> keras<span style=color:#f92672>.</span>layers<span style=color:#f92672>.</span>Dense(<span style=color:#ae81ff>8</span>, activation<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;relu&#39;</span>)(d)
</span></span><span style=display:flex><span>  outputs <span style=color:#f92672>=</span> keras<span style=color:#f92672>.</span>layers<span style=color:#f92672>.</span>Dense(<span style=color:#ae81ff>3</span>)(d)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  model <span style=color:#f92672>=</span> keras<span style=color:#f92672>.</span>Model(inputs<span style=color:#f92672>=</span>inputs, outputs<span style=color:#f92672>=</span>outputs)
</span></span><span style=display:flex><span>  model<span style=color:#f92672>.</span>compile(
</span></span><span style=display:flex><span>      optimizer<span style=color:#f92672>=</span>keras<span style=color:#f92672>.</span>optimizers<span style=color:#f92672>.</span>Adam(<span style=color:#ae81ff>1e-2</span>),
</span></span><span style=display:flex><span>      loss<span style=color:#f92672>=</span>tf<span style=color:#f92672>.</span>keras<span style=color:#f92672>.</span>losses<span style=color:#f92672>.</span>SparseCategoricalCrossentropy(from_logits<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>),
</span></span><span style=display:flex><span>      metrics<span style=color:#f92672>=</span>[keras<span style=color:#f92672>.</span>metrics<span style=color:#f92672>.</span>SparseCategoricalAccuracy()])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  model<span style=color:#f92672>.</span>summary(print_fn<span style=color:#f92672>=</span>logging<span style=color:#f92672>.</span>info)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> model
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># TFX Trainer will call this function.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>run_fn</span>(fn_args: tfx<span style=color:#f92672>.</span>components<span style=color:#f92672>.</span>FnArgs):
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;&#34;&#34;Train the model based on given args.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  Args:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    fn_args: Holds args used to train the model as name/value pairs.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># This schema is usually either an output of SchemaGen or a manually-curated</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># version provided by pipeline author. A schema can also derived from TFT</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># graph if a Transform component is used. In the case when either is missing,</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># `schema_from_feature_spec` could be used to generate schema from very simple</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># feature_spec, but the schema returned would be very primitive.</span>
</span></span><span style=display:flex><span>  schema <span style=color:#f92672>=</span> schema_utils<span style=color:#f92672>.</span>schema_from_feature_spec(_FEATURE_SPEC)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  train_dataset <span style=color:#f92672>=</span> _input_fn(
</span></span><span style=display:flex><span>      fn_args<span style=color:#f92672>.</span>train_files,
</span></span><span style=display:flex><span>      fn_args<span style=color:#f92672>.</span>data_accessor,
</span></span><span style=display:flex><span>      schema,
</span></span><span style=display:flex><span>      batch_size<span style=color:#f92672>=</span>_TRAIN_BATCH_SIZE)
</span></span><span style=display:flex><span>  eval_dataset <span style=color:#f92672>=</span> _input_fn(
</span></span><span style=display:flex><span>      fn_args<span style=color:#f92672>.</span>eval_files,
</span></span><span style=display:flex><span>      fn_args<span style=color:#f92672>.</span>data_accessor,
</span></span><span style=display:flex><span>      schema,
</span></span><span style=display:flex><span>      batch_size<span style=color:#f92672>=</span>_EVAL_BATCH_SIZE)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  model <span style=color:#f92672>=</span> _build_keras_model()
</span></span><span style=display:flex><span>  model<span style=color:#f92672>.</span>fit(
</span></span><span style=display:flex><span>      train_dataset,
</span></span><span style=display:flex><span>      steps_per_epoch<span style=color:#f92672>=</span>fn_args<span style=color:#f92672>.</span>train_steps,
</span></span><span style=display:flex><span>      validation_data<span style=color:#f92672>=</span>eval_dataset,
</span></span><span style=display:flex><span>      validation_steps<span style=color:#f92672>=</span>fn_args<span style=color:#f92672>.</span>eval_steps)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># The result of the training should be saved in `fn_args.serving_model_dir`</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># directory.</span>
</span></span><span style=display:flex><span>  model<span style=color:#f92672>.</span>save(fn_args<span style=color:#f92672>.</span>serving_model_dir, save_format<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;tf&#39;</span>)
</span></span></code></pre></div><p>Create <code>Dockerfile</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># TFX build </span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> tensorflow/tfx:1.2.0</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir /data<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> wget https://raw.githubusercontent.com/tensorflow/tfx/master/tfx/examples/penguin/data/labelled/penguins_processed.csv -P /data<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /pipeline</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> penguin_pipeline/*.py ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> PYTHONPATH<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/pipeline:</span><span style=color:#e6db74>${</span>PYTHONPATH<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>Next, build the pipeline as a Docker container and push it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker build . -t kfp-quickstart:v1
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>docker push kfp-quickstart:v1
</span></span></code></pre></div><h2 id=2-create-a-pipeline-resource>2. Create a Pipeline Resource</h2><p>Now that we have a pipeline image, we can create a <code>pipeline.yaml</code> resource to manage the lifecycle of this pipeline on Kubeflow:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>pipelines.kubeflow.org/v1alpha2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pipeline</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>penguin-pipeline</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>image</span>: <span style=color:#ae81ff>kfp-quickstart:v1</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f resources/pipeline.yaml
</span></span></code></pre></div><p>The pipeline now gets uploaded to Kubeflow in several steps. After a few seconds to minutes, the following command should result in a success:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pipeline
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME               SYNCHRONIZATIONSTATE   KFPID
</span></span><span style=display:flex><span>penguin-pipeline   Succeeded              53905abe-0337-48de-875d-67b9285f3cf7
</span></span></code></pre></div><p>Now visit you Kubeflow Pipelines UI. You should be able to see the newly created pipeline named <code>penguin-pipeline</code>. Note that you will see two versions: &lsquo;penguin-pipeline&rsquo; and &lsquo;v1&rsquo;. This is due to an <a href=https://github.com/kubeflow/pipelines/issues/5881>open issue on Kubeflow</a> where you can&rsquo;t specify a version when creating a pipeline.</p><h2 id=3-create-an-experiment-resource>3. Create an Experiment resource</h2><p>Note: this step is optional. You can continue with the next step if you want to use the <code>Default</code> experiment instead.</p><p>Create <code>experiment.yaml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>pipelines.kubeflow.org/v1alpha2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Experiment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>penguin-experiment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Description</span>: <span style=color:#e6db74>&#39;An experiment for the penguin pipeline&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f resources/experiment.yaml
</span></span></code></pre></div><h2 id=4-create-a-pipeline-runconfiguration-resource>4. Create a pipeline RunConfiguration resource</h2><p>We can now define a recurring run declaratively using the <code>RunConfiguration</code> resource.</p><p>Note: remove <code>experimentName</code> if you want to use the <code>Default</code> experiment instead of <code>penguin-experiment</code></p><p>Create <code>runconfiguration.yaml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>pipelines.kubeflow.org/v1alpha2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>RunConfiguration</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>penguin-pipeline-recurring-run</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>pipeline</span>: <span style=color:#ae81ff>penguin-pipeline</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>experimentName</span>: <span style=color:#ae81ff>penguin-experiment</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>schedule</span>: <span style=color:#e6db74>&#39;0 0 * * * *&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f resources/runconfiguration.yaml
</span></span></code></pre></div><p>This will trigger run of <code>penguin-pipeline</code> once every hour. Note that the cron schedule uses a 6-place space separated syntax as defined <a href=https://pkg.go.dev/github.com/robfig/cron#hdr-CRON_Expression_Format>here</a>.</p><h2 id=5-optional-deploy-newly-trained-models>5. (Optional) Deploy newly trained models</h2><p>If the operator has been installed with <a href=https://argoproj.github.io/argo-events/>Argo-Events</a> support, we can now specify eventsources and sensors to update arbitrary Kubernetes config when a pipeline has been trained successfully.
In this example we are updating a serving component with the location of the newly trained model.</p><p>Create <code>apply-model-location.yaml</code>. This creates an <code>EventSource</code> and a <code>Sensor</code> as well as an <code>EventBus</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>argoproj.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>EventBus</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>nats</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>native</span>: {}
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>argoproj.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>EventSource</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>run-completion</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>generic</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>run-completion</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>insecure</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>url</span>: <span style=color:#e6db74>&#34;kfp-operator-run-completion-eventsource-server.kfp-operator-system.svc:8080&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>config</span>: |-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        </span>        <span style=color:#f92672>kfpNamespace</span>: <span style=color:#ae81ff>kubeflow-pipelines</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>argoproj.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Sensor</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>penguin-pipeline-model-update</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>serviceAccountName</span>: <span style=color:#ae81ff>events-sa</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>dependencies</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>run-completion</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>eventSourceName</span>: <span style=color:#ae81ff>run-completion</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>eventName</span>: <span style=color:#ae81ff>run-completion</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>filters</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>body</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>template</span>: <span style=color:#e6db74>&#39;{{ ((b64dec .Input) | mustFromJson).status }}&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>comparator</span>: <span style=color:#e6db74>&#34;=&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>value</span>:
</span></span><span style=display:flex><span>              - <span style=color:#e6db74>&#34;succeeded&#34;</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>body</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>template</span>: <span style=color:#e6db74>&#39;{{ ((b64dec .Input) | mustFromJson).pipelineName }}&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>type</span>: <span style=color:#ae81ff>string</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>comparator</span>: <span style=color:#e6db74>&#34;=&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>value</span>:
</span></span><span style=display:flex><span>              - <span style=color:#e6db74>&#34;penguin-pipeline&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>triggers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>k8s</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>operation</span>: <span style=color:#ae81ff>update</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>source</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>resource</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>name</span>: <span style=color:#ae81ff>serving-config</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>servingModel</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>parameters</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>src</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>dependencyName</span>: <span style=color:#ae81ff>run-completion</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>dataKey</span>: <span style=color:#e6db74>&#39;{{ (index ((b64dec .Input) | mustFromJson).servingModelArtifacts 0).location }}&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>data.servingModel</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f resources/apply-model-location.yaml
</span></span></code></pre></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=https://sky-uk.github.io/kfp-operator/js/tabpane-persist.js></script>
<script src=https://sky-uk.github.io/kfp-operator/js/main.min.3b34ac477febeaa31ad0139e5e3eb406523359c611bf32317e9f46cfbf1f01b2.js integrity="sha256-OzSsR3/r6qMa0BOeXj60BlIzWcYRvzIxfp9Gz78fAbI=" crossorigin=anonymous></script></body></html>